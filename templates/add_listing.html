<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Listings</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f0f4f0; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .navbar { background-color: #fff; padding: 10px 20px; border-radius: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .navbar .logo { font-weight: 700; font-size: 1.5rem; color: #2e7d32; text-decoration: none;}
        .navbar .nav-links a { color: #333; text-decoration: none; margin-left: 15px; font-weight: 600; }
        h1 { color: #2e7d32; text-align: center; margin-bottom: 20px;}
        .vegetables-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .vegetable-card { background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); display: block; /* Puthu maatham */ }
        .vegetable-image img { width: 100%; height: 140px; object-fit: cover; border-radius: 12px 12px 0 0; }
        .vegetable-info { padding: 15px; }
        .vegetable-name { font-size: 1.3rem; color: #2e7d32; text-align: center; font-weight: 600; margin-bottom: 10px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-container { flex: 1; }
        .input-container label { font-size: 0.9rem; color: #555; margin-bottom: 5px; display: block; }
        .input-container input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .card-total { font-weight: 700; color: #1b5e20; text-align: center; font-size: 1.1rem; padding-top: 10px; border-top: 1px solid #eee; }
        .action-buttons { text-align: center; margin-top: 30px; }
        .btn { padding: 14px 28px; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; background: linear-gradient(to right, #4caf50, #8bc34a); color: white; font-weight: 600; }
        .category-heading { font-size: 1.8rem; color: #333; margin-top: 40px; margin-bottom: 15px; border-bottom: 2px solid #2e7d32; padding-bottom: 5px; }
        .controls-container { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .search-box { width: 100%; padding: 12px; font-size: 1.1rem; border: 2px solid #ddd; border-radius: 5px; margin-bottom: 15px; box-sizing: border-box; }
        .category-filters { text-align: center; }
        .category-btn { background-color: #e8f5e9; border: none; color: #2e7d32; padding: 8px 18px; margin: 5px; border-radius: 20px; font-weight: 600; cursor: pointer; font-size: 0.9rem; }
        .category-btn.active { background-color: #2e7d32; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="navbar">
            <a href="/market" class="logo">Farmer's Rule</a>
            <div class="nav-links">
                <a href="/market">Market</a> <a href="/dashboard">Dashboard</a> <a href="/logout">Logout</a>
            </div>
        </div>
        
        <h1>Post Your Produce</h1>
        <p style="text-align: center; margin-top: -15px; margin-bottom: 25px;">Find your vegetable and enter the quantity and rate.</p>

        <div class="controls-container">
            <input type="text" id="search-input" class="search-box" placeholder="Search for a vegetable...">
            <div class="category-filters" id="category-filters">
                <button class="category-btn active" data-filter="all">All</button>
                {% for category in vegetables.keys() %}
                <button class="category-btn" data-filter="{{ category }}">{{ category }}</button>
                {% endfor %}
            </div>
        </div>

        <form action="/add_listing" method="POST">
            {% for category, veggies in vegetables.items() %}
            <div class="category-section" data-category="{{ category }}">
                <h2 class="category-heading">{{ category }}</h2>
                <div class="vegetables-grid">
                    {% for veg in veggies %}
                    <div class="vegetable-card" data-name="{{ veg.name.lower() }}">
                        <div class="vegetable-image"><img src="{{ veg.img }}" alt="{{ veg.name }}"></div>
                        <div class="vegetable-info">
                            <h3 class="vegetable-name">{{ veg.name }}</h3>
                            <div class="input-group">
                                <div class="input-container"><label>Kgs Available</label><input type="number" step="0.5" name="quantity_{{ veg.name }}" class="kg-input" min="0"></div>
                                <div class="input-container"><label>Price/Kg (₹)</label><input type="number" step="0.01" name="rate_{{ veg.name }}" class="rate-input" min="0"></div>
                            </div>
                            <div class="card-total">Total: ₹0.00</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            <div class="action-buttons">
                <button type="submit" class="btn">Post All Selected Items</button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Price Calculation Logic
            const allCardsForCalc = document.querySelectorAll('.vegetable-card');
            allCardsForCalc.forEach(function(card) {
                const kgInput = card.querySelector('.kg-input'); const rateInput = card.querySelector('.rate-input'); const totalDisplay = card.querySelector('.card-total');
                function calculateCardTotal() { const kg = parseFloat(kgInput.value) || 0; const rate = parseFloat(rateInput.value) || 0; totalDisplay.textContent = `Total: ₹${(kg * rate).toFixed(2)}`; }
                kgInput.addEventListener('input', calculateCardTotal); rateInput.addEventListener('input', calculateCardTotal);
            });
            // Search and Filter Logic
            const searchInput = document.getElementById('search-input');
            const filterButtons = document.querySelectorAll('.category-btn');
            const categorySections = document.querySelectorAll('.category-section');
            function updateView() {
                const searchTerm = searchInput.value.toLowerCase(); const activeFilter = document.querySelector('.category-btn.active').dataset.filter;
                categorySections.forEach(section => {
                    let sectionHasVisibleCard = false;
                    const cardsInSection = section.querySelectorAll('.vegetable-card');
                    cardsInSection.forEach(card => {
                        const nameMatch = card.dataset.name.includes(searchTerm); const categoryMatch = (activeFilter === 'all' || section.dataset.category === activeFilter);
                        if (nameMatch && categoryMatch) { card.style.display = 'block'; sectionHasVisibleCard = true; } else { card.style.display = 'none'; }
                    });
                    if (sectionHasVisibleCard) { section.style.display = 'block'; } else { section.style.display = 'none'; }
                });
            }
            searchInput.addEventListener('input', updateView);
            filterButtons.forEach(button => { button.addEventListener('click', function() { filterButtons.forEach(btn => btn.classList.remove('active')); this.classList.add('active'); updateView(); }); });
            updateView();
        });
    </script>
</body>
</html>